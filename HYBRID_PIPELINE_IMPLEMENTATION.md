# Hybrid Pipeline Implementation - ุชุทุจูู CRM ููููุฏูุจูู

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅุนุงุฏุฉ ุชุตููู ุงูุชุทุจูู ุจุงููุงูู ููุชูุงูู ูุน ููุงุตูุงุช **Hybrid Pipeline Implementation v1.0** ูุน:
- โ ุฏุนู ูุงูู ููุบุฉ ุงูุนุฑุจูุฉ ูุน RTL
- โ Offline-First Architecture
- โ ุชุตููู ููุจุงูู ุฃููุงู (Mobile-First) ุจุฃุณููุจ Jibble
- โ UX/UI ูุชูุงูู ูุน ูุนุงููุฑ 2026
- โ ูุธุงู 5 Outcomes ุฅูุฒุงูู
- โ NextStep Engine ูุชูุงูู
- โ Sales Pipeline ูุน Quote Management

---

## ุงูุจููุฉ ุงูุฌุฏูุฏุฉ

### 1. ุดุฑูุท ุงูุญุงูุฉ ุงูุฏุงุฆู (Persistent Status Bar)
**ุงููููุน:** `src/design-system/components/feedback/StatusBar/`

**ุงููููุฒุงุช:**
- ูุคุดุฑ ุญุงูุฉ ุงูุงุชุตุงู (Online/Offline/Syncing)
- ุนุฑุถ ุขุฎุฑ ููุช ูุฒุงููุฉ
- ุนุฏุงุฏ ุงูุนูููุงุช ุงููุนููุฉ (Outbox)
- ุชูุจูู ููุชุนุงุฑุถุงุช
- ุฑุณูู ูุชุญุฑูุฉ ุณูุณุฉ

**ุงูุงุณุชุฎุฏุงู:**
```tsx
<StatusBar
  connectionStatus={connectionStatus}
  lastSyncTime={lastSyncTime}
  outboxCount={outboxCount}
  conflictCount={conflictCount}
  onStatusClick={() => navigate('/diagnostics/offline')}
/>
```

---

### 2. ูุธุงู ุงููุฒุงููุฉ (Sync Context)
**ุงููููุน:** `src/app/contexts/SyncContext.tsx`

**ุงููุธุงุฆู:**
```typescript
interface SyncContextValue {
  // ุญุงูุฉ ุงูุงุชุตุงู
  connectionStatus: 'online' | 'offline' | 'syncing';
  isOnline: boolean;
  
  // ุญุงูุฉ ุงููุฒุงููุฉ
  syncStatus: SyncStatus;
  lastSyncTime: Date | null;
  
  // Outbox Queue
  outboxItems: OutboxItem[];
  outboxCount: number;
  conflictCount: number;
  
  // Actions
  triggerSync: () => Promise<void>;
  addToOutbox: (item) => void;
  retryFailedItems: () => Promise<void>;
  resolveConflict: (id, resolution) => Promise<void>;
}
```

---

### 3. ุงูุดุงุดุฉ ุงูุฑุฆูุณูุฉ (Home Dashboard V2)
**ุงููุณุงุฑ:** `/app/home`  
**ุงูููู:** `src/app/screens/home/HomeDashboardV2.tsx`

**ุงูููููุงุช:**
1. **Status Bar** - ุดุฑูุท ุงูุญุงูุฉ ูู ุงูุฃุนูู
2. **Day Start/Clock-In** - ุฒุฑ ุชุณุฌูู ุงูุญุถูุฑ ุงูุฑุฆูุณู
3. **ุฅุญุตุงุฆูุงุช ุงูููู** - ุนุฑุถ ุณุฑูุน ููุฅูุฌุงุฒุงุช
4. **ุงูุนููุงุก ุงููุฑูุจูู** - ุฎุฑูุทุฉ ุงูููุทูุฉ ูุน ุงููุณุงูุงุช
5. **ุฌุฏูู ุงูููู** - ุงูููุงู ูุงูููุงุนูุฏ

**ุงููููุฏ (Constraints):**
- โ ูุง ูููู ุจุฏุก ุฒูุงุฑุฉ ูุจู Clock-In
- โ ุฌููุน ุงูุฃุฒุฑุงุฑ ุชุตุจุญ ูุดุทุฉ ุจุนุฏ Clock-In

---

### 4. ุชุฏูู ุงูุฒูุงุฑุฉ ุงููุดุทุฉ (Active Visit Workflow)
**ุงููุณุงุฑ:** `/visit/active/:visitId`  
**ุงูููู:** `src/app/screens/visit/ActiveVisit.tsx`

**ุงููุฑุงุญู:**
1. **Check-In GPS** - ุชุณุฌูู ุงููููุน ุจุฏูุฉ ุนุงููุฉ
2. **ููุงุญุธุงุช ุงูุชูุงุนู** - ูุต ุญุฑ ููููุงุญุธุงุช
3. **ุงูุตูุฑ ูุงููุฑููุงุช** - ุฑูุน ุงููุณุงุฆุท ูุน queue ููุฃูููุงูู

**GPS Status:**
- ๐ข High (< 10m) - ุฏูุฉ ุนุงููุฉ
- ๐ก Medium (10-50m) - ุฏูุฉ ูุชูุณุทุฉ
- ๐ด Low (> 50m) - ุฏูุฉ ููุฎูุถุฉ
- โซ Unavailable - ุบูุฑ ูุชุงุญ

---

### 5. ูุชุงุฆุฌ ุงูุฒูุงุฑุฉ (5 Outcomes)
**ุงููุณุงุฑ:** `/visit/outcome/:visitId`  
**ุงูููู:** `src/app/screens/visit/VisitOutcome.tsx`

**ุงูุฎูุงุฑุงุช ุงูุฅูุฒุงููุฉ (5 ููุท):**

| ุงููุชูุฌุฉ | ุงูุฑูุฒ | ุงููุชุทูุจุงุช |
|---------|------|-----------|
| **ูุง ููุฌุฏ ุชูุงุตู** | ๐ | ูุชุทูุจ ุฎุทูุฉ ุชุงููุฉ |
| **ููุชู** | ๐ค | ูุชุทูุจ ุฎุทูุฉ ุชุงููุฉ |
| **ุบูุฑ ููุชู** | ๐ | ูุชุทูุจ ุณุจุจ ุงูุฑูุถ |
| **ูุนูููุงุช ุฎุงุทุฆุฉ** | โ | ูุชุทูุจ ุชุตุญูุญ ุงูุจูุงูุงุช |
| **ุชู ุงูุจูุน!** | ๐ฐ | ูุชุทูุจ ุฅูุดุงุก ุทูุจ |

**ุงูุชูุฌูู ุงูุฅูุฒุงูู:**
- `interested` ุฃู `no_contact` โ ุดุงุดุฉ NextStep
- `sold` โ ุดุงุดุฉ Deal Pipeline
- `not_interested` โ ุฅููุงุก ูุน ุณุจุจ
- `wrong_info` โ ุฅููุงุก ูุน ุชุตุญูุญ

---

### 6. ูุญุฑู ุงูุฎุทูุฉ ุงูุชุงููุฉ (NextStep Engine)
**ุงููุณุงุฑ:** `/visit/next-step/:visitId`  
**ุงูููู:** `src/app/screens/visit/NextStep.tsx`

**ุงูุฎูุงุฑุงุช:**

#### ุฃ) ููุนุฏ (Appointment)
- ุงูุชุงุฑูุฎ ูุงูููุช
- ุงูููุถูุน
- ุชูุจูู ุชููุงุฆู

#### ุจ) ูููุฉ (Task)
- ุงูุนููุงู
- ุชุงุฑูุฎ ุงูุงุณุชุญูุงู
- ุงูุฃููููุฉ (ุนุงุฌู/ุนุงุฏู/ููุฎูุถ)

#### ุฌ) ุนุฑุถ ุณุนุฑ (Quote)
- ููุงุญุธุงุช ุฃูููุฉ
- ููุฌู ูุดุงุดุฉ Deal Pipeline

---

### 7. ุตููุฉ ุงููุจูุนุงุช (Sales Pipeline)
**ุงููุณุงุฑ:** `/visit/deal-pipeline/:visitId`  
**ุงูููู:** `src/app/screens/visit/DealPipeline.tsx`

**ุงููุฑุงุญู:**
1. ุงูุงูุชุดุงู (Discovery)
2. ููุงุกูุฉ ุงูุญู (Solution Fit)
3. ุงูุนุฑุถ (Proposal) โญ ุงูุญุงูุฉ ุงูุญุงููุฉ
4. ุงูุชูุงูุถ (Negotiation)
5. ููุชุณุจุฉ (Won) / ููููุฏุฉ (Lost)

**ุฅุฏุงุฑุฉ ุงูุฃุณุนุงุฑ:**
- ุจููุฏ ุงูุฎุฏูุงุช (Line Items)
- ุฎุตู ูุงุจู ููุชุนุฏูู
- โ๏ธ ุฎุตู > 15% ูุชุทูุจ ููุงููุฉ ุงููุฏูุฑ
- ููุงุนุฏ ุชุณุนูุฑ (Price Rules Version)
- ุญุณุงุจ ุชููุงุฆู ููุฅุฌูุงูู

---

### 8. ุงูุชุดุฎูุต ูุงูุฃูููุงูู (Offline Diagnostics)
**ุงููุณุงุฑ:** `/diagnostics/offline`  
**ุงูููู:** `src/app/screens/diagnostics/OfflineDiagnostics.tsx`

**ุฅุฏุงุฑุฉ Outbox Queue:**

| ุงูุญุงูุฉ | ุงูุฃููููุฉ | ุงููุตู |
|--------|---------|-------|
| Pending | โณ | ูู ุงูุชุธุงุฑ ุงููุฒุงููุฉ |
| Uploading | โฌ๏ธ | ุฌุงุฑู ุงูุฑูุน (ูุน ูุณุจุฉ ุงูุชูุฏู) |
| Synced | โ | ุชูุช ุงููุฒุงููุฉ |
| Error | โ | ูุดู (ูููู ุฅุนุงุฏุฉ ุงููุญุงููุฉ) |
| Conflict | โ๏ธ | ุชุนุงุฑุถ (ูุชุทูุจ ุญู ูุฏูู) |

**ุงูุฅุฌุฑุงุกุงุช ุงููุชุงุญุฉ:**
- ูุฒุงููุฉ ุงูุขู
- ุฅุนุงุฏุฉ ูุญุงููุฉ ุงููุงุดูุฉ
- ุญู ุงูุชุนุงุฑุถุงุช (ูุญูู/ุฎุงุฏู)
- ุญุฐู ุงูููุชููุฉ

---

## ุงูุชุฎุฒูู ุงููุญูู (Offline Storage)

**ุงููููุน:** `src/app/services/offlineStorage.ts`

**IndexedDB Stores:**
```typescript
STORES = {
  VISITS: 'visits',
  PARTIES: 'parties',
  TASKS: 'tasks',
  QUOTES: 'quotes',
  MEDIA: 'media',
  METADATA: 'metadata'
}
```

**ุงููุธุงุฆู:**
```typescript
- save(storeName, data)
- get(storeName, id)
- getAll(storeName)
- delete(storeName, id)
- clear(storeName)
```

---

## ูุณุงุฑุงุช ุงูุชุทุจูู (Routes)

### ุงูุฑุฆูุณูุฉ
- `/` - Splash Gate
- `/auth/login` - ุชุณุฌูู ุงูุฏุฎูู
- `/app/home` - ุงูุดุงุดุฉ ุงูุฑุฆูุณูุฉ V2

### ุชุฏูู ุงูุฒูุงุฑุฉ (Visit Flow)
- `/visit/active/:visitId` - ุงูุฒูุงุฑุฉ ุงููุดุทุฉ
- `/visit/outcome/:visitId` - ุงููุชุงุฆุฌ
- `/visit/next-step/:visitId` - ุงูุฎุทูุฉ ุงูุชุงููุฉ
- `/visit/deal-pipeline/:visitId` - ุตููุฉ ุงููุจูุนุงุช

### ุงูุชุดุฎูุต
- `/diagnostics/offline` - ุงูุชุดุฎูุต ูุงูุฃูููุงูู
- `/app/sync-status` - ูุนูุฏ ุชูุฌูู ุฅูู Diagnostics

### Legacy (ููุชูุงูู)
- `/dropin/*` - ุงูุดุงุดุงุช ุงููุฏููุฉ

---

## ุชุฏูู ุงูุนูู ุงููุงูู (Complete Workflow)

```
1. ุงูุดุงุดุฉ ุงูุฑุฆูุณูุฉ
   โ (Clock In)
   
2. ุงุฎุชูุงุฑ ุนููู ูุฑูุจ
   โ (Start Visit)
   
3. ุงูุฒูุงุฑุฉ ุงููุดุทุฉ
   โโ Check-In GPS โ
   โโ ููุงุญุธุงุช ุงูุชูุงุนู โ
   โโ ุตูุฑ/ูุฑููุงุช โ
   โ (Proceed to Outcome)
   
4. ุงุฎุชูุงุฑ ุงููุชูุฌุฉ (5 Outcomes)
   โโ No Contact โ NextStep
   โโ Interested โ NextStep
   โโ Not Interested โ ุณุจุจ + ุฅููุงุก
   โโ Wrong Info โ ุชุตุญูุญ + ุฅููุงุก
   โโ Sold โ Deal Pipeline
   
5a. NextStep (ุฅุฐุง ูุทููุจ)
    โโ Appointment โ ุญูุธ + ุฅููุงุก
    โโ Task โ ุญูุธ + ุฅููุงุก
    โโ Quote โ Deal Pipeline
    
5b. Deal Pipeline (ุฅุฐุง sold/quote)
    โโ ุชุนุฏูู ุงูุฎุฏูุงุช
    โโ ุชุทุจูู ุฎุตู
    โโ ุทูุจ ููุงููุฉ (ุฅุฐุง > 15%)
    โโ ุชุฃููุฏ ุงูุจูุน (Won)
    
6. ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ
   โโ ุนุฑุถ ุฑุณุงูุฉ ุงููุฌุงุญ
```

---

## Design Tokens ุงููุณุชุฎุฏูุฉ

**ุงูุฃููุงู:**
```css
--brand-primary-500: #F97316  /* ุงูุจุฑุชูุงูู ุงูุฃุณุงุณู */
--brand-primary-600: #EA580C  /* ุนูุฏ Hover */
--brand-soft: #FFF2E8          /* ุฎูููุฉ ูุงุนูุฉ */

--status-success: #16A34A     /* ูุฌุงุญ */
--status-warning: #F59E0B     /* ุชุญุฐูุฑ */
--status-error: #EF4444       /* ุฎุทุฃ */
--status-info: #3B82F6        /* ูุนูููุงุช */
```

**ุงูุธูุงู:**
```css
--shadow-card: 0px 6px 10px rgba(0, 0, 0, 0.08)
--shadow-lg: 0px 8px 16px rgba(0, 0, 0, 0.10)
```

**ุงูุญูุงู:**
```css
--radius-lg: 18px  /* ููุจุทุงูุงุช */
--radius-xl: 24px  /* ููุนูุงุตุฑ ุงููุจูุฑุฉ */
```

---

## ุงููููุฏ ูุงูููุงุนุฏ (Invariants)

### โ ูุง ูููู:
- ุจุฏุก ุฒูุงุฑุฉ ูุจู Clock-In
- ุฅููุงุก ุฒูุงุฑุฉ ุจุฏูู ุงุฎุชูุงุฑ Outcome
- ุงูุฎุฑูุฌ ูู NextStep ุจุฏูู ุชุญุฏูุฏ ุฎุทูุฉ
- ุฎุตู > 15% ุจุฏูู ููุงููุฉ

### โ ูุฌุจ:
- GPS ุฏููู ุนูุฏ Check-In
- ููุงุญุธุงุช ุชูุงุนู ูู ูู ุฒูุงุฑุฉ
- ุณุจุจ ุนูุฏ ุงุฎุชูุงุฑ "ุบูุฑ ููุชู"
- ุชุตุญูุญ ุจูุงูุงุช ุนูุฏ "ูุนูููุงุช ุฎุงุท๏ฟฝ๏ฟฝุฉ"

---

## ุงูููุฒุงุช ุงูุฅุถุงููุฉ

### 1. Offline-First
- ุฌููุน ุงูุนูููุงุช ุชุนูู ุจุฏูู ุงุชุตุงู
- ุญูุธ ุชููุงุฆู ูู IndexedDB
- ูุฒุงููุฉ ุชููุงุฆูุฉ ุนูุฏ ุงูุงุชุตุงู
- ูุงุฆูุฉ ุงูุชุธุงุฑ ุฐููุฉ (Outbox)

### 2. GPS Tracking
- ุฏูุฉ ุนุงููุฉ (High Accuracy Mode)
- ูุฑุงูุจุฉ ูุณุชูุฑุฉ (Watch Position)
- ุชุตููู ุญุณุจ ุงูุฏูุฉ
- ุชูุจูู ุฅุฐุง ุฏูุฉ ููุฎูุถุฉ

### 3. Media Management
- ุฑูุน ุงูุตูุฑ ุชููุงุฆูุงู
- Queue ููุฃูููุงูู
- ูุคุดุฑ ุงูุชูุฏู
- ูุนุงููุฉ ูุตุบุฑุฉ (Thumbnails)

### 4. Smart Routing
- ุชูุฌูู ุฏููุงูููู ุญุณุจ Outcome
- ููุน ุงูุฑุฌูุน ูู ูุฑุงุญู ูุนููุฉ
- ุญูุธ ุงูุญุงูุฉ (State Management)

---

## ุงุณุชุฎุฏุงู Design System

ุฌููุน ุงูููููุงุช ุชุณุชุฎุฏู **Design System** ุงููุจูู ูู ุงููุดุฑูุน:

```tsx
// โ ูุง ุชุณุชุฎุฏู
<div className="bg-orange-500">

// โ ุงุณุชุฎุฏู Design Tokens
<div style={{ backgroundColor: 'var(--brand-primary-500)' }}>

// โ ุฃู ุงุณุชุฎุฏู ุงูููููุงุช ุงูุฌุงูุฒุฉ
<Button variant="primary">
<Card variant="elevated">
<Badge variant="success">
<Text variant="h3">
```

---

## ุงูุชุฑุฌูุฉ ุงูุนุฑุจูุฉ ุงููุงููุฉ

- โ ุฌููุน ุงููุตูุต ุจุงูุนุฑุจูุฉ
- โ RTL ูุงูู ูู ูู ุงูุดุงุดุงุช
- โ ุชูุณูู ุงูุชุงุฑูุฎ ูุงูููุช ุจุงูุนุฑุจูุฉ
- โ ุงูุฃุฑูุงู ูุงููุฏุฎูุงุช LTR (ุญุณุจ ุงููุนูุงุฑ)

---

## ุงูุฎุทูุงุช ุงููุงุฏูุฉ (Future Enhancements)

1. **Background Sync API** - ูููุฒุงููุฉ ูู ุงูุฎูููุฉ
2. **Push Notifications** - ุชูุจููุงุช ููููุงุนูุฏ
3. **Geofencing** - ุชูุจูู ุนูุฏ ุงูุงูุชุฑุงุจ ูู ุนููู
4. **Voice Notes** - ุชุณุฌูู ุตูุชู ููููุงุญุธุงุช
5. **Analytics Dashboard** - ุชูุงุฑูุฑ ูุชุญูููุงุช
6. **Team Collaboration** - ูุดุงุฑูุฉ ุงูุจูุงูุงุช ุจูู ุงูููุฏูุจูู

---

## ุงูุฏุนู ูุงูุตูุงูุฉ

### ููุฅุจูุงุบ ุนู ูุดููุฉ:
1. ุงูุชุญ ุดุงุดุฉ ุงูุชุดุฎูุต (`/diagnostics/offline`)
2. ุฑุงุฌุน Outbox Queue
3. ุชุญูู ูู Console Logs
4. ุฃุฑุณู ุชูุฑูุฑ ููุตู

### ูููุทูุฑูู:
- ุฌููุน ุงููููุงุช ููุซูุฉ ุจู JSDoc
- ููุฏ ูุธูู 100%
- Design System ูููุตู
- TypeScript ููุฃูุงู

---

**ุชู ุงูุชุทููุฑ ูููุงู ูููุงุตูุงุช Hybrid Pipeline Implementation v1.0**  
**ูุชูุงูู ูุน UX/UI 2026**  
**ุจุฃุณููุจ Jibble ุงููุธูู ูุงูุนุตุฑู** ๐
